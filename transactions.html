<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Transactions">
    <title>Transactions - Mon Budget Malin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="enhanced-styles.css">
    <link rel="stylesheet" href="modern-components.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="plotly.js"></script>
</head>
<body>
    <!-- VÃ©rification d'authentification -->
    <script>
        // VÃ©rifier si l'utilisateur est connectÃ©
        function checkAuth() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
        }
        
        // ExÃ©cuter la vÃ©rification au chargement
        checkAuth();
    </script>

    <!-- Barre de navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="icon-192.png" alt="Logo" class="nav-logo">
                <span class="nav-title">ğŸ’° Mon Budget Malin</span>
            </div>
            <div class="nav-user">
                <div id="connection-status" class="connection-status">
                    <span class="status-indicator offline">ğŸ”´ Hors ligne</span>
                </div>
                <div id="user-info" class="user-info">
                    <span id="user-name" class="user-name">ğŸ‘¤ <span id="display-name">Utilisateur</span></span>
                    <button id="logout-btn" class="logout-btn">ğŸšª DÃ©connexion</button>
                </div>
            </div>
        </div>
    </nav>

    <nav class="breadcrumb">
        <a href="index.html">ğŸ  Accueil</a> > <span>Transactions</span>
    </nav>

    <!-- RÃ©sumÃ© des transactions -->
    <section>
        <h2>ğŸ“Š RÃ©sumÃ© des transactions</h2>
        <div class="summary-container">
            <div class="summary-item">
                <span class="summary-label">ğŸ’° Total Revenus :</span>
                <span id="total-revenus" class="summary-value amount-positive">0 FCFA</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">ğŸ’¸ Total DÃ©penses :</span>
                <span id="total-depenses" class="summary-value amount-negative">0 FCFA</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">ğŸ’³ Solde :</span>
                <span id="solde" class="summary-value">0 FCFA</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">ğŸ“‹ Nombre de transactions :</span>
                <span id="transaction-count" class="summary-value">0</span>
            </div>
        </div>
    </section>

    <!-- Formulaire d'ajout de transaction amÃ©liorÃ© -->
    <section>
        <h2>â• Nouvelle transaction</h2>
        <form id="transaction-form" class="enhanced-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="date">ğŸ“… Date :</label>
                    <input type="date" id="date" required>
                    <div class="form-hint">Date de la transaction</div>
                </div>
                <div class="form-group">
                    <label for="type">ğŸ“Š Type :</label>
                    <select id="type" required>
                        <option value="">SÃ©lectionnez le type</option>
                        <option value="revenu">ğŸ’° Revenu</option>
                        <option value="depense">ğŸ’¸ DÃ©pense</option>
                    </select>
                    <div class="form-hint">Type de transaction</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="category">CatÃ©gorie :</label>
                    <select id="category" required>
                        <option value="">SÃ©lectionnez une catÃ©gorie</option>
                        <!-- Options pour revenus -->
                        <option value="salaire" data-type="revenu">ğŸ’° Salaire</option>
                        <option value="bonus" data-type="revenu">ğŸ Bonus</option>
                        <option value="freelance" data-type="revenu">ğŸ’¼ Freelance</option>
                        <option value="investissement" data-type="revenu">ğŸ“ˆ Investissement</option>
                        <!-- Options pour dÃ©penses -->
                        <option value="nourriture" data-type="depense">ğŸ½ï¸ Nourriture</option>
                        <option value="transport" data-type="depense">ğŸš— Transport</option>
                        <option value="logement" data-type="depense">ğŸ  Logement</option>
                        <option value="sante" data-type="depense">ğŸ¥ SantÃ©</option>
                        <option value="communication" data-type="depense">ğŸ“± Communication</option>
                        <option value="loisirs" data-type="depense">ğŸ® Loisirs</option>
                        <option value="vetements" data-type="depense">ğŸ‘• VÃªtements</option>
                        <option value="education" data-type="depense">ğŸ“š Ã‰ducation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">Montant (FCFA) :</label>
                    <input type="number" id="amount" placeholder="0" required min="0" step="1000">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="payment-method">Mode de paiement :</label>
                    <select id="payment-method" required>
                        <option value="">SÃ©lectionnez le mode</option>
                        <option value="mobile-money">ğŸ“± Mobile Money</option>
                        <option value="especes">ğŸ’µ EspÃ¨ces</option>
                        <option value="carte">ğŸ’³ Carte bancaire</option>
                        <option value="virement">ğŸ¦ Virement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Description (optionnel) :</label>
                    <input type="text" id="description" placeholder="Description de la transaction">
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <span class="btn-icon">ğŸ’¾</span>
                    Enregistrer
                </button>
                <button type="reset" class="btn-secondary">
                    <span class="btn-icon">ğŸ”„</span>
                    RÃ©initialiser
                </button>
            </div>
        </form>
    </section>

    <!-- Liste des transactions -->
    <section>
        <h2>ğŸ“‹ Historique des transactions</h2>
        <div class="transactions-controls">
            <div class="filter-controls">
                <select id="filter-type" class="filter-select">
                    <option value="">Tous les types</option>
                    <option value="revenu">ğŸ’° Revenus</option>
                    <option value="depense">ğŸ’¸ DÃ©penses</option>
                </select>
                <select id="filter-category" class="filter-select">
                    <option value="">Toutes les catÃ©gories</option>
                </select>
                <input type="month" id="filter-month" class="filter-date">
            </div>
            <div class="sort-controls">
                <select id="sort-by" class="sort-select">
                    <option value="date">ğŸ“… Par date</option>
                    <option value="amount">ğŸ’° Par montant</option>
                    <option value="category">ğŸ“‚ Par catÃ©gorie</option>
                </select>
            </div>
        </div>
        
        <div id="transactions-list" class="transactions-list">
            <!-- Les transactions seront affichÃ©es ici -->
        </div>
    </section>

    <script src="app.js"></script>
    <script>
        // Afficher le nom de l'utilisateur
        function displayUserInfo() {
            const userName = localStorage.getItem('user_name') || 'Utilisateur';
            document.getElementById('display-name').textContent = userName;
        }

        // GÃ©rer la dÃ©connexion
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user_email');
            localStorage.removeItem('user_name');
            window.location.href = 'login.html';
        });

        // Afficher les informations utilisateur au chargement
        displayUserInfo();

        // Charger et afficher les transactions
        function loadTransactions() {
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            displayTransactions(transactions);
            updateSummary(transactions);
        }

        // Afficher les transactions
        function displayTransactions(transactions) {
            const container = document.getElementById('transactions-list');
            container.innerHTML = '';

            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <h3>Aucune transaction</h3>
                        <p>Commencez par ajouter votre premiÃ¨re transaction</p>
                    </div>
                `;
                return;
            }

            // Grouper par date
            const groupedTransactions = groupTransactionsByDate(transactions);

            Object.keys(groupedTransactions).forEach(date => {
                const dayTransactions = groupedTransactions[date];
                const daySection = document.createElement('div');
                daySection.className = 'transaction-day';
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `
                    <h3>${formatDate(date)}</h3>
                    <span class="day-total">${calculateDayTotal(dayTransactions)} FCFA</span>
                `;
                daySection.appendChild(dayHeader);

                dayTransactions.forEach(transaction => {
                    const transactionElement = createTransactionElement(transaction);
                    daySection.appendChild(transactionElement);
                });

                container.appendChild(daySection);
            });
        }

        // CrÃ©er un Ã©lÃ©ment de transaction
        function createTransactionElement(transaction) {
            const element = document.createElement('div');
            element.className = `transaction-item ${transaction.type}`;
            
            const icon = transaction.type === 'revenu' ? 'ğŸ’°' : 'ğŸ’¸';
            const amountClass = transaction.type === 'revenu' ? 'amount-positive' : 'amount-negative';
            
            element.innerHTML = `
                <div class="transaction-icon">${icon}</div>
                <div class="transaction-details">
                    <div class="transaction-category">${getCategoryIcon(transaction.category)} ${transaction.category}</div>
                    <div class="transaction-description">${transaction.description || 'Aucune description'}</div>
                    <div class="transaction-meta">
                        <span class="transaction-date">${formatDate(transaction.date)}</span>
                        <span class="transaction-payment">${getPaymentIcon(transaction.paymentMethod)} ${transaction.paymentMethod}</span>
                    </div>
                </div>
                <div class="transaction-amount ${amountClass}">
                    ${transaction.type === 'revenu' ? '+' : '-'}${formatAmount(transaction.amount)} FCFA
                </div>
                <div class="transaction-actions">
                    <button class="btn-edit" onclick="editTransaction('${transaction.id}')">âœï¸</button>
                    <button class="btn-delete" onclick="deleteTransaction('${transaction.id}')">ğŸ—‘ï¸</button>
                </div>
            `;
            
            return element;
        }

        // Fonctions utilitaires
        function groupTransactionsByDate(transactions) {
            return transactions.reduce((groups, transaction) => {
                const date = transaction.date;
                if (!groups[date]) {
                    groups[date] = [];
                }
                groups[date].push(transaction);
                return groups;
            }, {});
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatAmount(amount) {
            return new Intl.NumberFormat('fr-FR').format(amount);
        }

        function calculateDayTotal(transactions) {
            const total = transactions.reduce((sum, transaction) => {
                return transaction.type === 'revenu' ? sum + transaction.amount : sum - transaction.amount;
            }, 0);
            return formatAmount(Math.abs(total));
        }

        function getCategoryIcon(category) {
            const icons = {
                'salaire': 'ğŸ’°',
                'bonus': 'ğŸ',
                'freelance': 'ğŸ’¼',
                'investissement': 'ğŸ“ˆ',
                'nourriture': 'ğŸ½ï¸',
                'transport': 'ğŸš—',
                'logement': 'ğŸ ',
                'sante': 'ğŸ¥',
                'communication': 'ğŸ“±',
                'loisirs': 'ğŸ®',
                'vetements': 'ğŸ‘•',
                'education': 'ğŸ“š'
            };
            return icons[category] || 'ğŸ“¦';
        }

        function getPaymentIcon(paymentMethod) {
            const icons = {
                'mobile-money': 'ğŸ“±',
                'especes': 'ğŸ’µ',
                'carte': 'ğŸ’³',
                'virement': 'ğŸ¦'
            };
            return icons[paymentMethod] || 'ğŸ’³';
        }

        function updateSummary(transactions) {
            const totalRevenus = transactions
                .filter(t => t.type === 'revenu')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalDepenses = transactions
                .filter(t => t.type === 'depense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const solde = totalRevenus - totalDepenses;

            document.getElementById('total-revenus').textContent = formatAmount(totalRevenus) + ' FCFA';
            document.getElementById('total-depenses').textContent = formatAmount(totalDepenses) + ' FCFA';
            document.getElementById('solde').textContent = formatAmount(Math.abs(solde)) + ' FCFA';
            document.getElementById('transaction-count').textContent = transactions.length;
        }

        // GÃ©rer le formulaire
        document.getElementById('transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const transaction = {
                id: Date.now().toString(),
                date: formData.get('date'),
                type: formData.get('type'),
                category: formData.get('category'),
                amount: parseFloat(formData.get('amount')),
                paymentMethod: formData.get('payment-method'),
                description: formData.get('description'),
                createdAt: new Date().toISOString()
            };

            // Sauvegarder la transaction
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));

            // Recharger l'affichage
            loadTransactions();

            // RÃ©initialiser le formulaire
            e.target.reset();
        });

        // Charger les transactions au dÃ©marrage
        loadTransactions();
    </script>
</body>
</html> 